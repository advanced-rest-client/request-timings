<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="../../../@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../../../@polymer/test-fixture/test-fixture.js"></script>
    <script src="../../../mocha/mocha.js"></script>
    <script src="../../../chai/chai.js"></script>
    <script src="../../../wct-mocha/wct-mocha.js"></script>

  </head>
  <body>

    <test-fixture id="Panel">
      <template>
        <request-timings-panel></request-timings-panel>
      </template>
    </test-fixture>

    <script type="module">
    import '../request-timings-panel.js';
    // import { a11ySuite } from '../../../wct-browser-legacy/a11ySuite.js';
    suite('Panel', () => {
      let element;
      let timings;
      let redirects;

      setup(() => {
        element = fixture('Panel');
        timings = {
          startTime: 1483368432132,
          blocked: 7.751456734,
          dns: 279.3812349,
          connect: 883.1201243,
          ssl: 633.0517329,
          send: 0.2900234,
          wait: 649.8810009,
          receive: 1.7121211
        };
        redirects = [{
          startTime: '2017-01-02T16:22:26.212Z',
          blocked: 10.697000019718,
          dns: -1,
          connect: -1,
          send: 0.34099997719749986,
          wait: 155.50400002393852,
          receive: 4.751000029500744,
          ssl: -1
        }, {
          startTime: '2017-01-02T16:22:26.212Z',
          blocked: 3.36500001139939,
          dns: -1,
          connect: -1,
          send: 0.06499997107311994,
          wait: 138.7439999962225,
          receive: 4.986000014469084,
          ssl: -1
        }];
      });

      test('Does not render redirects if not set', (done) => {
        element.timings = timings;
        flush(() => {
          assert.isFalse(element.hasRedirects);
          const panel = element.shadowRoot.querySelector('.redirects');
          assert.notOk(panel);
          done();
        });
      });

      test('Render general timings only when redirects if not set', (done) => {
        element.timings = timings;
        flush(() => {
          const panel = element.shadowRoot.querySelector('request-timings');
          assert.ok(panel);
          done();
        });
      });

      test('Renders redirect information when available', (done) => {
        element.timings = timings;
        element.redirectTimings = redirects;
        flush(() => {
          assert.isTrue(element.hasRedirects);
          const panel = element.shadowRoot.querySelector('.redirects');
          assert.ok(panel);
          done();
        });
      });

      test('Renders 2 redirects tables and final table', (done) => {
        element.timings = timings;
        element.redirectTimings = redirects;
        flush(() => {
          const panels = element.shadowRoot.querySelectorAll('.timings-row');
          assert.equal(panels.length, 3);
          done();
        });
      });


      test('Computes requestTotalTime', () => {
        element.timings = timings;
        element.redirectTimings = redirects;
        assert.equal(element.requestTotalTime, 2773.6407);
      });
    });

    // a11ySuite('Panel');
    </script>

  </body>
</html>
